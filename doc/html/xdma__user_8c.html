<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Kintex-7: xdma/xdma_user.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kintex-7</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_1c64272130d509cdb89bf3690093e211.html">xdma</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xdma_user.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kernel.h&gt;</code><br/>
<code>#include &lt;linux/timer.h&gt;</code><br/>
<code>#include &lt;linux/jiffies.h&gt;</code><br/>
<code>#include &lt;linux/pci.h&gt;</code><br/>
<code>#include &lt;linux/mm.h&gt;</code><br/>
<code>#include &lt;linux/spinlock.h&gt;</code><br/>
<code>#include &lt;linux/pagemap.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="xbasic__types_8h_source.html">xbasic_types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdebug_8h_source.html">xdebug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xstatus_8h_source.html">xstatus.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xio_8h_source.html">xio.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma_8h_source.html">xdma.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__bd_8h_source.html">xdma_bd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__user_8h_source.html">xdma_user.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__hw_8h_source.html">xdma_hw.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#abdaa00f7453cce5fc24cb3ff3df4331a">DmaRegister</a> (int engine, int bar, <a class="el" href="structUserPtrs.html">UserPtrs</a> *uptr, int pktsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#a4104c7117330f48cb334c5c08538ad8e">DmaUnregister</a> (void *handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#a824084db65f9e70d7c8d33ab570cd01e">DmaBaseAddress</a> (int bar)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aab8c2bf6429c266ea0a91b9366091282"></a><!-- doxytag: member="xdma_user.c::DmaMac_WriteReg" ref="aab8c2bf6429c266ea0a91b9366091282" args="(int offset, int data)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>DmaMac_WriteReg</b> (int offset, int data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a16097e2c8f7114ae9e903ee316e32eab"></a><!-- doxytag: member="xdma_user.c::DmaMac_ReadReg" ref="a16097e2c8f7114ae9e903ee316e32eab" args="(int offset)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>DmaMac_ReadReg</b> (int offset)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0a523ca84435034b7ffef8455cc18322"></a><!-- doxytag: member="xdma_user.c::DmaSendPages_Tx" ref="a0a523ca84435034b7ffef8455cc18322" args="(void *handle, PktBuf **pkts, int numpkts)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>DmaSendPages_Tx</b> (void *handle, <a class="el" href="structPktBuf.html">PktBuf</a> **pkts, int numpkts)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9099e27a46b28c75f8312cb82818933e"></a><!-- doxytag: member="xdma_user.c::DmaSendPages" ref="a9099e27a46b28c75f8312cb82818933e" args="(void *handle, PktBuf **pkts, int numpkts)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>DmaSendPages</b> (void *handle, <a class="el" href="structPktBuf.html">PktBuf</a> **pkts, int numpkts)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a4887f61ce11a3c112b861cd2651026"></a><!-- doxytag: member="xdma_user.c::DmaSendPkt" ref="a3a4887f61ce11a3c112b861cd2651026" args="(void *handle, PktBuf *pkts, int numpkts)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>DmaSendPkt</b> (void *handle, <a class="el" href="structPktBuf.html">PktBuf</a> *pkts, int numpkts)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0f734d179fd7daf2ce78707fae32b7c2"></a><!-- doxytag: member="xdma_user.c::Dma_get_ringparam" ref="a0f734d179fd7daf2ce78707fae32b7c2" args="(void *handle, struct ethtool_ringparam *ering)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>Dma_get_ringparam</b> (void *handle, struct ethtool_ringparam *ering)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Contains the APIs used by the application-specific drivers.</p>
<p>Author: Xilinx, Inc.</p>
<p>2007-2010 (c) Xilinx, Inc. This file is licensed uner the terms of the GNU General Public License version 2.1. This program is licensed "as is" without any warranty of any kind, whether express or implied.</p>
<p>MODIFICATION HISTORY:</p>
<p>Ver Date Changes ----- -------- ------------------------------------------------------- 1.0 05/15/12 First release </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a824084db65f9e70d7c8d33ab570cd01e"></a><!-- doxytag: member="xdma_user.c::DmaBaseAddress" ref="a824084db65f9e70d7c8d33ab570cd01e" args="(int bar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* DmaBaseAddress </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bar</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the DMA base address to the user driver</p>
<p>In 10G support, the MAC address registers are not mapped to MAC address space. The MAC address registers are mapped to the DMA address area. Hence, the user driver should know the DMA base address, so that it can access the MAC address registers to Set/Get MAC address.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">bar</td><td>is the BAR register the user driver wants to use.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>DMABaseAddress </dd></dl>

<p>References <a class="el" href="structprivData.html#a40afec97f1c7a5c5e2a19295ba98c065">privData::baseVAddr</a>, <a class="el" href="xdma_8h.html#aafe97d27b1b23279ec57b4c8f64d2369">dmaData</a>, and <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>.</p>

</div>
</div>
<a class="anchor" id="abdaa00f7453cce5fc24cb3ff3df4331a"></a><!-- doxytag: member="xdma_user.c::DmaRegister" ref="abdaa00f7453cce5fc24cb3ff3df4331a" args="(int engine, int bar, UserPtrs *uptr, int pktsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* DmaRegister </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structUserPtrs.html">UserPtrs</a> *&#160;</td>
          <td class="paramname"><em>uptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pktsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function must be called by the user driver to register itself with the base DMA driver. After doing required checks to verify the choice of engine and BAR register, it initializes the engine and the BD ring associated with the engine, and enables interrupts if required.</p>
<p>Only one user is supported per engine at any given time. Incase the engine has already been registered with another user driver, an error will be returned.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">engine</td><td>is the DMA engine the user driver wants to use. </td></tr>
    <tr><td class="paramname">bar</td><td>is the BAR register the user driver wants to use. </td></tr>
    <tr><td class="paramname">uptr</td><td>is a pointer to the function callbacks in the user driver. </td></tr>
    <tr><td class="paramname">pktsize</td><td>is the size of packets that the user driver will normally use.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL incase of any error in completing the registration. </dd>
<dd>
Handle with which the user driver is registered.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be called in an interrupt context </dd></dl>

<p>References <a class="el" href="structprivData.html#a40afec97f1c7a5c5e2a19295ba98c065">privData::baseVAddr</a>, <a class="el" href="structDma__Engine.html#a908c7a2313424f11f5b61ba6bc3bdffc">Dma_Engine::BdRing</a>, <a class="el" href="xdma_8h.html#ad5d703a389553efc7322a29711908ca4">descriptor_init()</a>, <a class="el" href="structprivData.html#a59eae8337eabcc719546fee384d49125">privData::Dma</a>, <a class="el" href="xdma__bdring_8c.html#a77800843381096be543f854420a69769">Dma_BdRingStart()</a>, <a class="el" href="xdma__hw_8h.html#a0e996a77348306cfcd58d44ffbe48b34">Dma_mEngIntEnable</a>, <a class="el" href="xdma_8h.html#aafe97d27b1b23279ec57b4c8f64d2369">dmaData</a>, <a class="el" href="structprivData.html#a1df10acd92546ec98acad78242562c55">privData::engineMask</a>, <a class="el" href="structDma__Engine.html#a4be2947a1ed70fe05e1f81931718e5b9">Dma_Engine::EngineState</a>, <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>, <a class="el" href="structDma__Engine.html#adbd482a091cf7cdcd2d7557ac4b4211d">Dma_Engine::pdev</a>, <a class="el" href="structDma__Engine.html#aa18e24638916943b6f77ddb191875525">Dma_Engine::pktSize</a>, <a class="el" href="structUserPtrs.html#afe89e8b90c431ce9f86587b56bfcd096">UserPtrs::privData</a>, <a class="el" href="structDma__Engine.html#a889ac212be067804cbec378b90a3c6a1">Dma_Engine::user</a>, <a class="el" href="xdma__user_8h.html#a9c24e8534e32ca5c349ed6b2c6ce1609">USER_ASSIGNED</a>, <a class="el" href="structprivData.html#a3145a5b450841717375c78636306557e">privData::userCount</a>, <a class="el" href="structUserPtrs.html#ac49aa8a8d59b855f685b8e0822b2f483">UserPtrs::UserInit</a>, and <a class="el" href="structUserPtrs.html#aa0d8cf9ac553db4da5e279597296b586">UserPtrs::versionReg</a>.</p>

</div>
</div>
<a class="anchor" id="a4104c7117330f48cb334c5c08538ad8e"></a><!-- doxytag: member="xdma_user.c::DmaUnregister" ref="a4104c7117330f48cb334c5c08538ad8e" args="(void *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DmaUnregister </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function must be called by the user driver to unregister itself from the base DMA driver. After doing required checks to verify the handle and engine state, the DMA engine is reset, interrupts are disabled if required, and the BD ring is freed, while returning all the packet buffers to the user driver.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>is the handle which was assigned during the registration process.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>XST_FAILURE incase of any error </dd>
<dd>
0 incase of success</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be called in an interrupt context </dd></dl>

<p>References <a class="el" href="xdma_8h.html#a81c8783e19a2f1f2c50f8273b286c50d">descriptor_free()</a>, <a class="el" href="xdma_8c.html#aa95c53b30b03661caea5e5c1279acd58">Dma_Reset()</a>, <a class="el" href="xdma_8h.html#aafe97d27b1b23279ec57b4c8f64d2369">dmaData</a>, <a class="el" href="structDma__Engine.html#a4be2947a1ed70fe05e1f81931718e5b9">Dma_Engine::EngineState</a>, <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>, <a class="el" href="structDma__Engine.html#adbd482a091cf7cdcd2d7557ac4b4211d">Dma_Engine::pdev</a>, <a class="el" href="xdma__user_8h.html#af633e59bd3235afc0e3ce5bb08376e39">UNREGISTERING</a>, <a class="el" href="xdma__user_8h.html#a9c24e8534e32ca5c349ed6b2c6ce1609">USER_ASSIGNED</a>, and <a class="el" href="structprivData.html#a3145a5b450841717375c78636306557e">privData::userCount</a>.</p>

</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue May 8 2012 18:55:49 for Kintex-7 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
